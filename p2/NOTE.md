### Score Metrics

å†³èµ›è¯„åˆ¤æ ‡å‡† (æ»¡åˆ†ä¸º 410 åˆ†)

1. æŒ¯å¹…ç¼–ç åçš„é‡å­æ€çŸ¢é‡ä¸åŸæ•°æ®çš„ç›¸ä¼¼åº¦ Fidelityï¼ŒæŒ¯å¹…ç¼–ç çº¿è·¯çš„å¤æ‚åº¦ (é—¨çš„ä¸ªæ•°)
2. é‡å­ç¥ç»ç½‘ç»œçš„ Top-1 åˆ†ç±»å‡†ç¡®ç‡ Accuracy
3. å®¢è§‚å¾—åˆ† = (2 * Fidelity + Accuracy + çº¿è·¯å¤æ‚åº¦å¾—åˆ† + 0.1 * è¿è¡Œæ—¶é—´å¾—åˆ†) * 100
4. çº¿è·¯å¤æ‚åº¦å¾—åˆ† = 1 - æŒ¯å¹…ç¼–ç çº¿è·¯é—¨çš„ä¸ªæ•° / 2000ï¼›è¦æ±‚æŒ¯å¹…ç¼–ç çº¿è·¯é—¨çš„ä¸ªæ•° <= 1000
5. è¿è¡Œæ—¶é—´å¾—åˆ† = 1 - è¿è¡Œæ—¶é—´ / 360ç§’ï¼›è¦æ±‚çº¿è·¯è°ƒç”¨ test_model() å‡½æ•°çš„è¿è¡Œæ—¶é—´ <= 360s


### Trails

> Q: è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æŸå¤±éƒ½èƒ½åŒæ­¥ä¸‹é™ï¼Œä½†ç²¾åº¦å¹¶éç¨³æ­¥åŒæ­¥ä¸Šå‡ï¼ŒWhy? (p1ä¹Ÿæœ‰æ­¤ç°è±¡)
> A: https://blog.51cto.com/u_12891/7785560

```
[Baseline]
test fid: 0.348
test acc: 0.306
test gates: 1212.000
runtime: 111.535
å®¢è§‚å¾—åˆ†: 146.514
```

âšª AmpEnc results

â„¹ ä¸€èˆ¬è€Œè¨€ï¼Œéœ€è¾¾åˆ° `fid=0.95` å·¦å³ï¼Œå¯è§†åŒ–ä¸ºå›¾åƒæ‰çœ‹èµ·æ¥æœ‰äººç±»å¯è¯†åˆ«çš„åŒä¸€æ€§ï¼›å¦å¯å‚è€ƒ [wtf-quantum-fidelity](https://github.com/Kahsolt/wtf-quantum-fidelity)  
âš  é¡»æ³¨æ„ï¼šç¼–ç ä¿çœŸåº¦ä¸åˆ†ç±»ç²¾åº¦çš„ç›¸å…³æ€§å¾ˆå¼±ï¼Œå³ enc å’Œ clf ä¸¤è€…å¹¶ä¸è§£è€¦ (å› ä¸ºæŒ¯å¹…ç¼–ç ä»…ä¿ç•™äº†æ•°æ®çš„ä½™å¼¦ç›¸ä¼¼åº¦ä¿¡æ¯ï¼Œå¯ä»¥è¯´å±€åŸŸæ€§ä¿¡æ¯å·²ç ´åæ®†å°½)ï¼›å› æ­¤å¿…é¡»å…ˆç¡®å®šå¥½ç¼–ç æ–¹æ¡ˆï¼Œæ‰èƒ½ç€æ‰‹ç ”ç©¶åˆ†ç±»å™¨ï¼  

> enc_score = 2 * fid + (1 - gcnt / 2000)

| enc(n_layer) | gcnt | fid | enc_score | comment |
| :-: | :-: | :-: | :-: | :-: |
| F1(1)   |  79     | 0.930 | 2.8205   | no_norm, n_iter=200 |
| F1(2)   | 157     | 0.954 | 2.8295   | no_norm, n_iter=200 |
| F1(3)   | 235     | 0.965 | 2.8125   | no_norm, n_iter=200 |
| F2(1)   | 145     | 0.966 | 2.8595   | no_norm, n_iter=500 |
| F2(3)   | 236.164 | 0.985 | 2.851918 | no_norm, n_iter=800(use_finetune=3:1) |
| F2(1)   | 101.446 | 0.961 | 2.871277 | no_norm, n_iter=400(use_finetune=3:1) (â­) |
| F2(1)   | 145     | 0.846 | 2.6195   |    norm, n_iter=500 |
| F2(2)   | 289     | 0.919 | 2.6935   |    norm, n_iter=500 |
| F2(1)   | 116.982 | 0.849 | 2.639509 |    norm, n_iter=400(use_finetune=3:1) |
| F2(2)   | 200.908 | 0.921 | 2.741546 |    norm, n_iter=400(use_finetune=3:1) |
| F2(3)   | 286.830 | 0.947 | 2.750585 |    norm, n_iter=400(use_finetune=3:1) |
| F2(3)   | 287.730 | 0.951 | 2.758135 |    norm, n_iter=800(use_finetune=3:1) (â­) |
| F2(2/3) | 248.210 | 0.944 | 2.763895 |    norm, n_iter=800(use_finetune=3:1); score:0.576â†‘, fid:0.007â†“ |
| F2(2/3) | 241.652 | 0.944 | 2.767174 |    norm, n_iter=800(use_finetune=3:1); remove |0>-ctrl |
| F2(3)   | 292.868 | 0.949 | 2.750686 |    norm, n_iter=800(use_finetune=3:1), +mse_loss |

âšª clf results

> total_score = (2 * fid + (1 - gcnt / 2000) + acc + 0.1) * 100

**with data_norm:**

| enc ckpt | clf(n_layer) | gcnt/pcnt | acc | ~total_score | comment |
| :-: | :-: | :-: | :-: | :-: | :-: |
| F2(3) [score:2.758135] | U-V brick(3)  [Ansatz]     |  504/ 846 | 45.2% | 331.0135 | |
| F2(3) [score:2.758135] | U-V all(1)    [AnsatzExt]  | 1285/1671 | 48.4% | 334.2135 | |
| F2(3) [score:2.758135] | U-V brick(1)  [CL]         |  216/ 450 | 40.8% | 326.6135 | |
| F2(3) [score:2.758135] | U-V brick(2)  [CL]         |  360/ 648 | 48.2% | 334.0135 | |
| F2(3) [score:2.758135] | U-V brick(3)  [CL]         |  504/ 846 | 52.8% | 338.6135 | ä¿®å¤ ref_data ç®—æ³•ï¼Œä»æœ‰7.4%çš„æ ·æœ¬æ— æ³•ä»ç†æƒ³è®­ç»ƒé›†æ³›åŒ–æ¥ (â­) |
| F2(3) [score:2.758135] | U-V brick(4)  [CL]         |  648/1044 | 50.0% | 335.8135 | |
| F2(3) [score:2.758135] | U-V brick(6)  [CL]         |  936/1440 | 49.2% | 335.0135 | |
| F2(3) [score:2.758135] | U-V brick(3)  [CLCascade]  |     -     | 56.2% | 342.0135 | æå‡æ²¡æœ‰æƒ³è±¡ä¸­çš„å¤§ã€‚ã€‚ã€‚ |
| F2(3) [score:2.758135] | U-V brick(3)  [CLEnsemble] |     -     | 60.2% | 346.0135 | ä¸‡ç‰©çš†å¯é›†æˆ |
| F2(3) [score:2.758135] | U-V brick(3)  [CLMLP]      |  504/1175 | 63.4% | 349.2135 | é€¼è¿‘ç»å…¸æ¨¡å‹ mlp2 |
| F2(3) [score:2.750686] | U-V brick(4)  [CL]         |  648/1044 | 51.4% | 336.4686 | +mse_loss å¯¹åˆ†ç±»å™¨å‹å¥½ä¸€ç‚¹ |
| F2(3) [score:2.750686] | U-V brick(3)  [CLMLP]      |  504/1175 | 65.2% | 350.2686 | +mse_loss å¯¹åˆ†ç±»å™¨å‹å¥½ä¸€ç‚¹ |

**without data_norm:**

| enc ckpt | clf(n_layer) | gcnt/pcnt | acc | ~total_score | comment |
| :-: | :-: | :-: | :-: | :-: | :-: |
| F2(1) [score:2.871277] | U-V brick(8)  [Ansatz] | 1224/1656 | 44.4% | 341.5277 | overfit; çº¯ Ansatz æ–¹æ³•å¾ˆå·®ï¼Œæ— æ³•é€¼è¿‘ç†è®º mlp0 |
| F2(1) [score:2.871277] | U-V brick(3)  [CL]     |  504/ 846 | 44.0% | 341.1277 | æˆ‘ä»¬è®¤ä¸ºæœ€åˆç†è€Œå¹¶ä¸ä½œå¼Šçš„è§£å†³æ–¹æ¡ˆ |
| F2(1) [score:2.871277] | U-V brick(10) [CL]     | 1512/2232 | 56.2% | 353.2100 | overfit |
| F2(1) [score:2.871277] | U-V brick(10) [CLMLP]  | 1512/2561 | 60.6% | 357.7277 | |
| F2(1) [score:2.871277] | U-V brick(10) [CLMLP]  | 1512/2561 | 85.0% | 382.1277 | overfit; loss/acc å¹¶æœªå®Œå…¨æ”¶æ•› (most cheaty! ğŸ˜ˆ) |


### å…³äºæ•°æ®è§„èŒƒåŒ–ã®åˆ†æ

å¦‚æœéµå®ˆè¿™ä¸ªæ¸¸æˆè§„åˆ™ï¼Œç¼–ç é—®é¢˜å°†éå¸¸å›°éš¾... ğŸ˜ˆ

$$ \text{Use} \ \left| x \right> = \frac{x}{\lvert| x \rvert|} \ \text{or} \ \left| x \right> = \frac{x - \mu}{\lvert| x - \mu \rvert|} \ \text{?} $$

|     | éè§„èŒƒåŒ–æ•°æ® | è§„èŒƒåŒ–æ•°æ® |
| :-: | :-: | :-: |
| åˆ†å¸ƒ | ä¸å¯¹ç§°ï¼Œå¯¹åˆ†ç±»å™¨ä¸åˆ© | æ¯”è¾ƒå¯¹ç§°ï¼Œå‡å€¼0ï¼›åˆ©å¥½åˆ†ç±»å™¨ |
| ç¬¦å· | æ’æ­£ï¼Œæ— éœ€å­¦ä¹ ç›¸ä½   | æœ‰æ­£æœ‰è´Ÿï¼Œéœ€è¦å­¦ä¹ ç›¸ä½ |
| enc(best) | score=2.871277 | score=2.750585 |

è§„èŒƒåŒ–æ•°æ®ã®å†…ç§¯ï¼Œ`sqrt(ä¿çœŸåº¦/ä½™å¼¦ç›¸ä¼¼åº¦)`:

$$
\left< x_2 | x_1 \right> \
= \frac{x_2 - \mu}{\lvert| x_2 - \mu \rvert|} \cdot \frac{x_1 - \mu}{\lvert| x_1 - \mu \rvert|}
$$


### Appendix

âšª Classical classifiers baselines

| model | param_cnt | accuracy | comment |
| :-: | :-: | :-: | :-: |
| vgg11            | 128786821 | 94.0% | æœ‰é¢„è®­ç»ƒæƒé‡ |
| resnet18         |  11171397 | 91.0% | æœ‰é¢„è®­ç»ƒæƒé‡ |
| mbnetv3_s        |   1522981 | 86.6% | æœ‰é¢„è®­ç»ƒæƒé‡ |
| mbnetv3_s        |   1522981 | 80.6% | æ— é¢„è®­ç»ƒæƒé‡ï¼Œå¤©èŠ±æ¿ |
| cnn              |      1712 | 71.0% | å¤æ‚ç»“æ„å¯ä»¥æ¶¨åˆ†ï¼Œä½†å¯è§å¤©èŠ±æ¿ |
| cnn_d3           |       497 | 60.2% | æ›´åšçš„ç‰¹å¾å›¾ï¼Œæ”¶ç›Šä¸å¤§ |
| cnn_d1           |       133 | 58.6% | å·ç§¯æ¨¡å‹å‚è€ƒæ ‡å‡† â­ |
| cnn_d1_L         |       133 | 50.2% | æ¿€æ´»å‡½æ•°é‡è¦ |
| cnn_d1_s2        |       133 | 58.4% | AvgPoolå¯å¿½ç•¥ |
| cnn_d1_s2_nb     |       125 | 52.4% | bias é‡è¦ |
| cnn_d1_s2_x16    |        83 | 48.4% | æ›´å°çš„ç‰¹å¾å›¾ç¡®å®æ›´å·® |
| cnn_d1_s2_x16_L  |        74 | 46.2% | å›¾å¤ªå°æ—¶ï¼Œæ¿€æ´»å‡½æ•°å¯å¿½ç•¥ |
| cnn_d1_s2_x16_nb |        74 | 45.6% | æç«¯å‹ç¼©ï¼Œä»ç„¶é«˜äºåŸºçº¿ QNN |
| cnn_nano         |        44 | 35.4% | åº•çº¿ï¼Œä¸åº”è¯¥æ¯”è¿™ä¸ªå·® |
| mlp0             |         - | 53.2%/67.6% | æ¨¡æ‹Ÿçº¯ ansatz æ–¹æ³•! ğŸ˜ˆ |
| mlp1             |     15365 | 57.2% | çº¿æ€§æ¨¡å‹å‚è€ƒæ ‡å‡† â­ |
| mlp1_nb          |     15365 | 56.6% | wtm ç›´æ¥çº¿è·¯åˆæˆ??! å‚è€ƒ mlp0 æ–¹æ³• |
| mlp2             |    787973 | 64.2% | æ¿€æ´»å‡½æ•°é‡è¦ |
| mlp2_drop        |    787973 | 63.2% | p=0.5 |
| mlp3             |   3410437 | 62.8% | è¿‡æ‹Ÿåˆäº† |
| knn              |           | 64.9% | k=5, p=1 |
| knn1             |           | 43.6%/45.2% | æš—ç¤ºæ•°æ®åˆ†å¸ƒå‘ˆå¤šä¸­å¿ƒåŒ– |
| rf               |           | 65.5% | |

ç»“è®º:

- æ— åç½®æ— æ¿€æ´»çš„æç®€å·ç§¯æ¨¡å‹ `cnn_d1_s2_nb` ç²¾åº¦ä¸º `52.4%`ï¼Œç²¾åº¦ç¨æ¬ ä½†å‚æ•°é‡ç¡®å®å°‘
- æ— åç½®æ— æ¿€æ´»çš„æç®€çº¿æ€§æ¨¡å‹ `mlp1_nb` ç²¾åº¦ä¸º `56.6%`
  - æ¨¡æ‹Ÿçº¯ ansatz æ–¹æ³• `mlp0` ç²¾åº¦ä¸º `53.2%`ï¼Œä»»ä½•å•çº¯ ansatz æ–¹æ³•ä¸åº”çªç ´è¿™ä¸ªæ•°å­—...
  - åœ¨é…ç½® `data_norm` ä¸‹å¯ä»¥è¾¾åˆ°ç²¾åº¦ `57.8%`!! æˆ‘ä»¬çœŸçš„è¿˜éœ€è¦ qam_flatten å—??
- **å·ç§¯æ¨¡å‹ä¸å¦‚çº¿æ€§æ¨¡å‹é‚£æ ·å®¹æ˜“åœ¨ circuit ä¸Šå®ç°**


#### reference

- (Quanvolution) https://github.com/anthonysmaldone/qcnn-multi-channel-supervised-learning
- (Hybrid) https://github.com/DRA-chaos/Quantum-Classical-Hyrid-Neural-Network-for-binary-image-classification-using-PyTorch-Qiskit-pipeline
- Qiskit
  - qiskit-machine-learning: https://github.com/qiskit-community/qiskit-machine-learning
    - doc: https://qiskit-community.github.io/qiskit-machine-learning/index.html
  - circuit synthesis: https://quantumcomputing.stackexchange.com/questions/13821/generate-a-3-qubit-swap-unitary-in-terms-of-elementary-gates/13826#13826
